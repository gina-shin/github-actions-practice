name: on-ui-staging-merge
on:
  push:
    branches:
      - 'staging'
    paths:
      - 'ui/**'
jobs:
  deploy-stage:
    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v2
    - name: Read .nvmrc
      run: echo ::set-output name=NODE_VERSION::$(cat .nvmrc)
      id: nvm

    - name: Use Node.js ${{ steps.nvm.outputs.NODE_VERSION }}
      uses: actions/setup-node@v2
      with:
        node-version: ${{ steps.nvm.outputs.NODE_VERSION }}
  
    - run: yarn install
    - run: yarn workspace ui deploy:stage

name: on-ui-main-merge
on:
  push:
    branches:
      - 'main'
    paths:
      - 'ui/**'
jobs:
  deploy-production:
    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v2
    - name: Read .nvmrc
      run: echo ::set-output name=NODE_VERSION::$(cat .nvmrc)
      id: nvm

    - name: Use Node.js ${{ steps.nvm.outputs.NODE_VERSION }}
      uses: actions/setup-node@v2
      with:
        node-version: ${{ steps.nvm.outputs.NODE_VERSION }}
  
    - run: yarn install
    - run: yarn workspace ui deploy:production

name: on-admin-staging-merge
on:
  push:
    branches:
      - 'staging'
    paths:
      - 'admin/**'
jobs:
  deploy-stage:
    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v2
    - name: Read .nvmrc
      run: echo ::set-output name=NODE_VERSION::$(cat .nvmrc)
      id: nvm

    - name: Use Node.js ${{ steps.nvm.outputs.NODE_VERSION }}
      uses: actions/setup-node@v2
      with:
        node-version: ${{ steps.nvm.outputs.NODE_VERSION }}
  
    - run: yarn install
    - run: yarn workspace admin deploy:stage

name: on-admin-main-merge
on:
  push:
    branches:
      - 'main'
    paths:
      - 'admin/**'
jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v2
    - name: Read .nvmrc
      run: echo ::set-output name=NODE_VERSION::$(cat .nvmrc)
      id: nvm

    - name: Use Node.js ${{ steps.nvm.outputs.NODE_VERSION }}
      uses: actions/setup-node@v2
      with:
        node-version: ${{ steps.nvm.outputs.NODE_VERSION }}
  
    - run: yarn install
    - run: yarn workspace admin deploy:stage